function changeState(e,t,n){if(n==1){$(e).removeClass("has-error").addClass("has-success");$(t).removeClass("glyphicon-remove").addClass("glyphicon-ok")}else if(n==0){$(e).removeClass("has-success");$(t).removeClass("glyphicon-ok").removeClass("glyphicon-remove")}else{$(e).addClass("has-error");$(t).addClass("glyphicon-remove")}}function checkISBN(){isbn=$("#isbn").val();if(isValidISBN13(isbn)||isValidISBN10(isbn)){changeState("#isbng","#isbnc",1);if(lastIsbn!=isbn){$(".selldiv").html($("#divLoadingBar").html());$.get("/ajax/bookinfo.php",{isbn:isbn},function(e){$(".selldiv").html(e)});lastIsbn=isbn}s=$(".selldiv").slideDown();if(isPriceValid()&&isQualityValid()&&isNewbookValid())$("#contsell").prop("disabled",false);else $("#contsell").prop("disabled",true)}else{changeState("#isbng","#isbnc",0);if(isbn.length==13)changeState("#isbng","#isbnc",0);s=$(".selldiv").slideUp();$("#contsell").prop("disabled",true)}changeState("#priceg","#pricec",isPriceValid()?1:$("#price").val().length>0?-1:0);if(isQualityValid)$("#qualityg").addClass("has-success");else $("#qualityg").removeClass("has-success")}function isNewbookValid(){if($("#newbookform").length>0){if($("#new_title").val()&&$("#new_author").val()&&$("#new_pages").val()&&$("#new_year").val())return true;else return false}else return true}function isPriceValid(){if($("#price").val().match("^([0-9]+([.,][0-9][0-9]?)?)$"))return true;else return false}function isQualityValid(){if($("#quality").val()==null)return false;return true}function isValidISBN10(e){var t,n;if(e.length!=10)return false;t=0;for(n=0;n<10;n++)if(e[n]=="X"||e[n]=="x")t+=10*(10-n);else if($.isNumeric(e[n]))t+=parseInt(e[n])*(10-n);else return false;return t%11==0}function isValidISBN13(e){var t,n;if(e.length!=13)return false;e=e.replace(/[-\s]/g,"");t=0;for(n=0;n<13;n+=2){t+=+e[n]}for(n=1;n<12;n+=2){t+=3*+e[n]}return t%10===0}function insertAtCaret(e,t){if(document.selection){e.focus();var n=document.selection.createRange();n.text=t;e.focus()}else if(e.selectionStart||e.selectionStart===0){var r=e.selectionStart;var i=e.selectionEnd;var s=e.scrollTop;e.value=e.value.substring(0,r)+t+e.value.substring(i,e.value.length);e.focus();e.selectionStart=r+t.length;e.selectionEnd=r+t.length;e.scrollTop=s}else{e.value+=t;e.focus()}}function popup(e,t){$("#msgtit").html(e);$("#msgtext").html(t);$("#msgpop").slideDown(300);$("#blackbg").fadeIn(300)}function hidepopup(){$("#msgpop").fadeOut(300);$("#blackbg").fadeOut(300);popupid=0;updateHash()}function showbook(e){popupid=e;$.get("/showbook.php?id="+e,function(e){updateHash();popup("Dettagli sul libro",e)})}function appendBooks(e,t){$.each(t,function(t,n){$("#"+e).append('<tr id="'+e+"_"+n.id+'"><td><a href="javascript:void(0);" onclick="showbook('+n.id+');">'+n.title+"</a></td><td>"+n.author+"</td><td>"+n.year+'</td><td><input type="text" value="'+n.where+'" style="width: 120px; border:0; text-align: center; background-color:rgba(255,255,255,0);" readonly/></td><td>'+n.quality+"</td><td>&euro;"+n.price+'</td><td title="'+n.realdate+'">'+n.date+"</td></tr>")})}function buildTable(e){out='<div class="table-responsive"><table class="table table-striped" id="'+e+'">';out+="<tr><th>Titolo</th><th>Autore</th><th>Anno</th><th>Sede</th><th>Qualit&agrave;</th><th>Prezzo</th><th>Pubblicato il</th></tr>";out+="</table></div>";return out}function loadRecentBooks(){$.getJSON("/ajax/search.php?data=lastest&page="+booksCounter,function(e){appendBooks("tblResult",e);showLoader(false);if(e.length==LIMIT&&booksCounter<MAXRECENTCOUNT-1)$("#btnContinue").show()})}function showLoader(e){if(e)$("#loadingAnim").show();else $("#loadingAnim").hide()}function getHashFromUrl(e){return $("<a />").attr("href",e)[0].hash.replace(/^#/,"")}function updateHash(){sx=$("#searchbox").val();hash="";if(sx!=null&&sx.length>3)hash="search="+encodeURIComponent(sx);if(popupid>0){if(hash.length>0)hash+="&";hash+="show="+popupid}window.location.hash=hash}function updateMain(){hash=getHashFromUrl(window.location);hx=hash.split("&");show=0;$.each(hx,function(e,t){px=t.split("=");if(px[0]=="show")show=parseInt(px[1])});if(show!=0)showbook(show);else hidepopup();$.getJSON("/ajax/search.php?data=lastest",function(e){$("#divBooks").html(buildTable("tblResult"));$("#divBooks").append('<a id="btnContinue" href="javascript:void(0);"><span class="glyphicon glyphicon-chevron-down" /></a>');if(e.length<LIMIT)$("#btnContinue").hide();$("#btnContinue").click(function(){booksCounter++;loadRecentBooks();$("#btnContinue").hide();showLoader(true)});appendBooks("tblResult",e);showLoader(false)})}function updateSearch(){hash=getHashFromUrl(window.location);hx=hash.split("&");src="";show=0;$.each(hx,function(e,t){px=t.split("=");if(px[0]=="searc